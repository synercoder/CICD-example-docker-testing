name: Docker

on:
  workflow_dispatch:

env:
  IMAGE_NAME: ${{ github.repository }}

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Build Docker images
        run: docker build -f HelloWeb/Dockerfile -t helloweb:dev .
      - name: Run container image
        timeout-minutes: 1
        run: |
          containerid=$(docker run -d -p 8080:80 helloweb:dev)
          until [ "`docker inspect -f {{.State.Health.Status}} $containerid`"=="healthy" ]; do
            sleep 0.1;
          done;
      - name: Run tests
        shell: pwsh
        env:
          - TEST_BASE_URL=http://localhost
        run: ./tests/RunTests.ps1
